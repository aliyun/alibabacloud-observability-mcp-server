# 阿里云可观测性MCP Server - 工具清单（按层）

本文档按 PaaS / IaaS 两层给出 MCP 工具精要清单，仅包含：工具、工具名称（中文）、使用说明、参数。

## PaaS 层工具
| 工具 | 工具名称 | 使用说明 | 参数 |
|---|---|---|---|
| umodel_get_entity_set | 获取实体集合定义 | 获取指定实体集合的架构与字段定义 | 必: domain, domain_type, workspace, regionId；选: from_time=now-5m, to_time=now |
| umodel_list_data_set | 列出数据集合 | 列出实体下可用的数据集（metric/log/event/trace） | 必: workspace, domain, domain_type, regionId；选: data_set_types, from_time=now-5m, to_time=now |
| umodel_search_entity_set | 搜索实体集合 | 按关键词全文搜索实体集合定义 | 必: search_text, workspace, regionId；选: domain, domain_type, limit=10 |
| umodel_list_related_entity_set | 列出相关实体集合 | 基于模型关系列出相关实体集合 | 必: domain, domain_type, workspace, regionId；选: relation_type, direction=both, detail=false |
| umodel_get_entities | 获取实体 | 分页/按ID获取实体基础信息 | 必: domain, domain_type, workspace, regionId；选: entity_ids, from_time=now-5m, to_time=now, limit=20 |
| umodel_get_neighbor_entities | 获取邻居实体 | 获取指定实体的邻居/依赖实体 | 必: domain, domain_type, entity_id, workspace, regionId；选: from_time=now-5m, to_time=now, limit=20 |
| umodel_search_entities | 搜索实体 | 按关键词搜索实体（支持通配符域/类型） | 必: domain, domain_type, search_text, workspace, regionId；选: from_time=now-5m, to_time=now, limit=20 |
| umodel_get_metrics | 获取指标 | 获取实体的时序指标（range/instant，可聚合） | 必: domain, domain_type, metric_domain_name, metric, workspace, regionId；选: entity_ids, query_type=range, aggregate=true, from_time=now-5m, to_time=now |
| umodel_get_golden_metrics | 获取黄金指标 | 获取实体的关键黄金指标（延迟/吞吐/错误/饱和） | 必: domain, domain_type, workspace, regionId；选: entity_ids, from_time=now-5m, to_time=now |
| umodel_get_relation_metrics | 获取关系指标 | 获取实体间关系指标（如调用时延/错误率） | 必: src_domain, src_domain_type, src_entity_ids, relation_type, direction, metric_set_domain, metric_set_name, metric, workspace, regionId；选: dest_domain, dest_domain_type, dest_entity_ids, query_type=range, from_time=now-5m, to_time=now |
| umodel_get_logs | 获取日志 | 获取实体相关日志数据 | 必: domain, domain_type, log_set_domain, log_set_name, workspace, regionId；选: entity_ids, from_time=now-5m, to_time=now |
| umodel_get_events | 获取事件 | 获取实体相关事件数据 | 必: domain, domain_type, event_set_domain, event_set_name, workspace, regionId；选: entity_ids, limit=100, from_time=now-5m, to_time=now |
| umodel_get_traces | 获取Trace详情 | 通过 trace_ids 获取Trace详情 | 必: domain, domain_type, trace_set_domain, trace_set_name, trace_ids, workspace, regionId；选: from_time=now-5m, to_time=now |
| umodel_search_traces | 搜索Trace | 按条件搜索Trace摘要（慢/错误/实体过滤） | 必: domain, domain_type, trace_set_domain, trace_set_name, workspace, regionId；选: entity_ids, min_duration_ms, max_duration_ms, has_error, limit=100, from_time=now-5m, to_time=now |
| umodel_get_profiles | 获取性能剖析 | 获取CPU/内存等性能剖析数据 | 必: domain, domain_type, profile_set_domain, profile_set_name, workspace, entity_ids, regionId；选: limit=100, from_time=now-5m, to_time=now |

## IaaS 层工具
| 工具 | 工具名称 | 使用说明 | 参数 |
|---|---|---|---|
| sls_text_to_sql | 自然语言转SQL | 将自然语言转换为SLS查询语句 | 必: text, project, logStore, regionId |
| sls_execute_sql | 执行SLS SQL | 在SLS日志库执行SQL查询 | 必: project, logStore, query, regionId；选: from_time=now-5m, to_time=now, limit=10(1-100) |
| sls_execute_promql | 执行PromQL | 在SLS指标库执行PromQL获取时序数据 | 必: project, metricStore, query, regionId；选: from_time=now-5m, to_time=now |
| sls_list_projects | 列出SLS项目 | 列出区域内SLS项目（支持模糊） | 必: regionId；选: projectName, limit=50(1-100) |
| sls_execute_spl | 执行SPL | 在CMS EntityStore执行原生SPL | 必: query, workspace, regionId；选: from_time=now-5m, to_time=now |
| sls_list_logstores | 列出日志库 | 列出项目内日志库/指标库（可模糊） | 必: project, regionId；选: logStore, limit=10(1-100), isMetricStore=false |

---

## 示例：如何判断一个应用 RT 突增的原因

使用组合法（推荐给工程/平台用户）
- 步骤A：定位是否确有 RT 异常
```python
umodel_get_golden_metrics(
  domain="apm", domain_type="apm.service",
  workspace="prod-workspace", regionId="cn-hangzhou",
  entity_ids="payment-service", from_time="now-2h", to_time="now"
)
```
- 步骤B：筛选慢/异常 Trace（对齐异常时间窗）
```python
umodel_search_traces(
  domain="apm", domain_type="apm.service",
  trace_set_domain="apm", trace_set_name="apm.trace.common",
  workspace="prod-workspace", regionId="cn-hangzhou",
  entity_ids="payment-service", min_duration_ms=1000, has_error=True,
  from_time="now-2h", to_time="now", limit=50
)
```
- 步骤C：获取 Top Trace 详情，定位最慢 Span/外部依赖
```python
umodel_get_traces(
  domain="apm", domain_type="apm.service",
  trace_set_domain="apm", trace_set_name="apm.trace.common",
  trace_ids="<从上一步挑选的traceId列表>",
  workspace="prod-workspace", regionId="cn-hangzhou",
  from_time="now-2h", to_time="now"
)
```
- 步骤D：验证是否由下游依赖导致（关系级指标）
```python
umodel_get_relation_metrics(
  src_domain="apm", src_domain_type="apm.service",
  src_entity_ids="payment-service", relation_type="calls", direction="out",
  metric_set_domain="apm", metric_set_name="apm.metric.relation", metric="latency",
  workspace="prod-workspace", regionId="cn-hangzhou",
  from_time="now-2h", to_time="now"
)
```
- 步骤E：结合错误/异常日志交叉验证
```python
umodel_get_logs(
  domain="apm", domain_type="apm.service",
  log_set_domain="app", log_set_name="app.log.common",
  workspace="prod-workspace", regionId="cn-hangzhou",
  entity_ids="payment-service", from_time="now-2h", to_time="now"
)
```

通过以上链路可判断：是自身代码热路径变慢、下游依赖抖动、错误重试放大，还是突发流量导致资源饱和等。

